<div class="container">
  <div class="page-header">
    <h1 class="page-title">ConfiguraÃ§Ã£o de Aprovadores de Hora Extra</h1>
    <p class="page-subtitle">Gerencie os aprovadores de solicitaÃ§Ãµes de hora extra</p>
  </div>

  <div class="actions-bar">
    <button class="btn btn-primary" (click)="abrirModal()">
      <span>+</span> Novo Aprovador
    </button>
  </div>

  @if (loading) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Carregando aprovadores...</p>
    </div>
  }

  @if (!loading && aprovadores.length > 0) {
    <!-- VisualizaÃ§Ã£o Desktop -->
    <div class="table-container desktop-view">
      <table class="table">
        <thead>
          <tr>
            <th>UsuÃ¡rio</th>
            <th>Login</th>
            <th>Tipo de AprovaÃ§Ã£o</th>
            <th>Status</th>
            <th>Data Cadastro</th>
            <th>AÃ§Ãµes</th>
          </tr>
        </thead>
        <tbody>
          @for (aprovador of aprovadores; track aprovador.id_config_aprovador) {
            <tr>
              <td><strong>{{ aprovador.nome_usuario }}</strong></td>
              <td>{{ aprovador.login }}</td>
              <td>
                <span class="tipo-badge" [class.tipo-e]="aprovador.tipo_aprovacao === 'E'" [class.tipo-ou]="aprovador.tipo_aprovacao === 'OU'">
                  {{ getTipoAprovacaoTexto(aprovador.tipo_aprovacao) }}
                </span>
              </td>
              <td>
                <span [class]="aprovador.ativo === 1 ? 'status-active' : 'status-inactive'">
                  {{ aprovador.ativo === 1 ? 'Ativo' : 'Inativo' }}
                </span>
              </td>
              <td>{{ aprovador.dt_inclusao | date:'dd/MM/yyyy HH:mm' }}</td>
              <td>
                <div class="d-flex gap-1">
                  <button class="btn btn-sm btn-secondary" (click)="alterarTipoAprovacao(aprovador)">
                    Alterar Tipo
                  </button>
                  <button
                    class="btn btn-sm"
                    [class.btn-success]="aprovador.ativo === 0"
                    [class.btn-danger]="aprovador.ativo === 1"
                    (click)="alterarStatus(aprovador)">
                    {{ aprovador.ativo === 1 ? 'Desativar' : 'Ativar' }}
                  </button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- VisualizaÃ§Ã£o Mobile -->
    <div class="mobile-view">
      @for (aprovador of aprovadores; track aprovador.id_config_aprovador) {
        <div class="item-card">
          <div class="item-card-header">
            <div class="item-card-title">
              <strong>{{ aprovador.nome_usuario }}</strong>
              <span [class]="aprovador.ativo === 1 ? 'status-active' : 'status-inactive'" class="status-badge-mobile">
                {{ aprovador.ativo === 1 ? 'Ativo' : 'Inativo' }}
              </span>
            </div>
            <div class="item-card-subtitle">{{ aprovador.login }}</div>
          </div>

          <div class="item-card-body">
            <div class="info-row">
              <div class="info-label">Tipo de AprovaÃ§Ã£o:</div>
              <div class="info-value">
                <span class="tipo-badge" [class.tipo-e]="aprovador.tipo_aprovacao === 'E'" [class.tipo-ou]="aprovador.tipo_aprovacao === 'OU'">
                  {{ getTipoAprovacaoTexto(aprovador.tipo_aprovacao) }}
                </span>
              </div>
            </div>
            <div class="info-row">
              <div class="info-label">Data Cadastro:</div>
              <div class="info-value">{{ aprovador.dt_inclusao | date:'dd/MM/yyyy HH:mm' }}</div>
            </div>
          </div>

          <div class="item-card-footer">
            <button class="btn btn-sm btn-secondary" (click)="alterarTipoAprovacao(aprovador)">
              ðŸ”„ Alterar Tipo
            </button>
            <button
              class="btn btn-sm"
              [class.btn-success]="aprovador.ativo === 0"
              [class.btn-danger]="aprovador.ativo === 1"
              (click)="alterarStatus(aprovador)">
              {{ aprovador.ativo === 1 ? 'ðŸš« Desativar' : 'âœ… Ativar' }}
            </button>
          </div>
        </div>
      }
    </div>
  }

  @if (!loading && aprovadores.length === 0) {
    <div class="no-data">
      <p>Nenhum aprovador cadastrado.</p>
    </div>
  }
</div>

<!-- Modal Novo Aprovador -->
@if (showModal) {
  <div class="modal-overlay" (click)="fecharModal()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">Novo Aprovador</h3>
        <button class="modal-close" (click)="fecharModal()">Ã—</button>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label class="form-label required">UsuÃ¡rio</label>
          <select [(ngModel)]="novoAprovador.id_usuario" class="form-control">
            <option value="0">Selecione um usuÃ¡rio</option>
            @if (usuarios && usuarios.length > 0) {
              @for (usuario of usuarios; track usuario.id_usuario) {
                <option [value]="usuario.id_usuario">{{ usuario.nome_usuario }} ({{ usuario.login }})</option>
              }
            }
          </select>
        </div>

        <div class="form-group">
          <label class="form-label required">Tipo de AprovaÃ§Ã£o</label>
          <select [(ngModel)]="novoAprovador.tipo_aprovacao" class="form-control">
            <option value="E">Todos devem aprovar (E)</option>
            <option value="OU">Pelo menos um deve aprovar (OU)</option>
          </select>
          <small class="form-text">
            <strong>E:</strong> Todos os aprovadores precisam aprovar<br>
            <strong>OU:</strong> Apenas um aprovador precisa aprovar
          </small>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="fecharModal()">Cancelar</button>
        <button class="btn btn-primary" (click)="salvarAprovador()" [disabled]="loading">
          {{ loading ? 'Salvando...' : 'Salvar' }}
        </button>
      </div>
    </div>
  </div>
}

