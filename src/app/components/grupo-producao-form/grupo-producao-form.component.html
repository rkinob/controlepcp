<!-- Modal Overlay -->
@if (isVisible) {
<div class="modal-overlay" (click)="onBackdropClick($event)">
  <div class="modal-container">
    <div class="modal-header">
      <h2 class="modal-title">{{ pageTitle }}</h2>
      <button class="modal-close" (click)="closeModal()" type="button">
        <span>&times;</span>
      </button>
    </div>

    <div class="modal-body">
      <form [formGroup]="grupoForm" (ngSubmit)="onSubmit()">
        <div class="form-grid">
          <div class="form-group full-width">
            <label for="descricao" class="form-label required">Descrição</label>
            <input
              type="text"
              id="descricao"
              formControlName="descricao"
              placeholder="Ex: Grupo A - Costura"
              class="form-control"
              [class.error]="grupoForm.get('descricao')?.invalid && grupoForm.get('descricao')?.touched"
            />
            @if (getFieldError('descricao')) {
              <div class="error-text">
                {{ getFieldError('descricao') }}
              </div>
            }
            @if (grupoForm.get('descricao')?.pending) {
              <div class="loading-text">
                Verificando descrição...
              </div>
            }
          </div>

          @if (isEditMode) {
            <div class="form-group">
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  formControlName="fl_ativo"
                  class="form-check-input"
                />
                Grupo Ativo
              </label>
            </div>
          }
        </div>

        @if (errorMessage) {
          <div class="alert alert-danger">
            {{ errorMessage }}
          </div>
        }
        @if (loading) {
          <div class="loading-text">
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            <p>{{ isEditMode ? 'Carregando grupo...' : 'Processando...' }}</p>
          </div>
        }
      </form>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="onCancel()">
        Cancelar
      </button>
      <button type="submit" class="btn btn-primary" [disabled]="grupoForm.invalid || saving" (click)="onSubmit()">
        @if (!saving) {
          <span>{{ submitButtonText }}</span>
        }
        @if (saving) {
          <span>
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            {{ submitButtonText }}
          </span>
        }
      </button>
    </div>
  </div>
</div>
}
