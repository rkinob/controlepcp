<!-- Modal Overlay -->
@if (isVisible) {
<div class="modal-overlay" (click)="onBackdropClick($event)">
  <div class="modal-container">
    <div class="modal-header">
      <h2 class="modal-title">{{ pageTitle }}</h2>
      <button class="modal-close" (click)="closeModal()" type="button">
        <span>&times;</span>
      </button>
    </div>

    <div class="modal-body">
      <form [formGroup]="modeloForm" (ngSubmit)="onSubmit()">
        <div class="form-grid">
          <div class="form-group">
            <label for="cd_modelo" class="form-label required">Código do Modelo</label>
            <input
              type="text"
              id="cd_modelo"
              formControlName="cd_modelo"
              placeholder="Ex: M001"
              class="form-control"
              [class.error]="modeloForm.get('cd_modelo')?.invalid && modeloForm.get('cd_modelo')?.touched"
            />
            @if (getFieldError('cd_modelo')) {
              <div class="error-text">
                {{ getFieldError('cd_modelo') }}
              </div>
            }
            @if (modeloForm.get('cd_modelo')?.pending) {
              <div class="loading-text">
                Verificando código...
              </div>
            }
          </div>

          <div class="form-group">
            <label for="meta_por_hora" class="form-label required">Meta por Hora</label>
            <input
              type="number"
              id="meta_por_hora"
              formControlName="meta_por_hora"
              placeholder="Ex: 100"
              min="0.01"
              step="0.01"
              class="form-control"
              [class.error]="modeloForm.get('meta_por_hora')?.invalid && modeloForm.get('meta_por_hora')?.touched"
            />
            @if (getFieldError('meta_por_hora')) {
              <div class="error-text">
                {{ getFieldError('meta_por_hora') }}
              </div>
            }
          </div>

          <div class="form-group full-width">
            <label for="descricao" class="form-label required">Descrição</label>
            <textarea
              id="descricao"
              formControlName="descricao"
              placeholder="Ex: Calça Jeans Masculina - Corte Reto"
              rows="3"
              class="form-control"
              [class.error]="modeloForm.get('descricao')?.invalid && modeloForm.get('descricao')?.touched"
            ></textarea>
            @if (getFieldError('descricao')) {
              <div class="error-text">
                {{ getFieldError('descricao') }}
              </div>
            }
          </div>

          @if (isEditMode) {
            <div class="form-group">
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  formControlName="fl_ativo"
                  class="form-check-input"
                />
                Modelo Ativo
              </label>
            </div>
          }
        </div>

        @if (errorMessage) {
          <div class="alert alert-danger">
            {{ errorMessage }}
          </div>
        }
        @if (loading) {
          <div class="loading-text">
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            <p>{{ isEditMode ? 'Carregando modelo...' : 'Processando...' }}</p>
          </div>
        }
      </form>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="onCancel()">
        Cancelar
      </button>
      <button type="submit" class="btn btn-primary" [disabled]="modeloForm.invalid || saving" (click)="onSubmit()">
        @if (!saving) {
          <span>{{ submitButtonText }}</span>
        }
        @if (saving) {
          <span>
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            {{ submitButtonText }}
          </span>
        }
      </button>
    </div>
  </div>
</div>
}
